<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embed Proxy</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
            overflow: hidden;
        }
        #container {
            width: min(100vw, calc(100vh * 16 / 9));
            height: min(100vh, calc(100vw * 9 / 16));
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <iframe id="embedFrame" allowfullscreen></iframe>
    </div>
    <script>
const iframe = document.getElementById('embedFrame');
iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen');

const raw = window.location.pathname.slice(1) + window.location.search;
if (!raw.trim()) {
  document.body.innerHTML = '<div class="error">No URL provided.<br>Use: /youtube.com/watch?v=abc<br>or /youtu.be/abc?t=30<br>or just /dQw4w9WgXcQ</div>';
  throw new Error("No input");
}

let embedUrl = '';

// Helper: detect playlist-looking IDs (PL..., VL..., UU..., FL..., or very long)
function isPlaylistID(id) {
  const clean = (id || '').split('?')[0];
  return clean.length > 15 && /^(PL|VL|UU|FL|LP|RD)/.test(clean);
}

// Extract params once
const urlParams = new URLSearchParams(window.location.search);

// ==================================================================
// 1. Bare video ID or playlist ID (e.g. /dQw4w9WgXcQ or /PLabc123...)
if (/^([A-Za-z0-9_-]{11}|[A-Za-z0-9_-]{15,})$/.test(raw.split('?')[0].split('&')[0])) {
  const maybeId = raw.split('?')[0].split('&')[0];
  const params = new URLSearchParams(urlParams);
  params.set('autoplay', '1');

  if (isPlaylistID(maybeId)) {
    embedUrl = `https://www.youtube-nocookie.com/embed/videoseries?list=${maybeId}&${params.toString()}`;
  } else {
    // Handle t= → parlamentare start=
    if (params.has('t')) {
      const t = parseInt(params.get('t'), 10);
      if (!isNaN(t)) params.set('start', t);
      params.delete('t');
    }
    embedUrl = `https://www.youtube-nocookie.com/embed/${maybeId}?${params.toString()}`;
  }
  iframe.src = embedUrl;
  console.log('Bare ID →', embedUrl);
  throw new Error("Done");
}

// ==================================================================
// 2. Full YouTube URL parsing
let cleaned = raw
  .replace(/^(https?:\/\/)?(www\.)?/gi, '')
  .replace(/#.*$/, '');

let videoId = null;
let finalParams = new URLSearchParams();
finalParams.set('autoplay', '1');

// — youtu.be links (most common shared form)
if (cleaned.includes('youtu.be/')) {
  videoId = cleaned.split('youtu.be/')[1].split('?')[0].split('&')[0].split('#')[0];
  
  if (urlParams.has('t')) {
    const t = parseInt(urlParams.get('t'), 10);
    if (!isNaN(t)) finalParams.set('start', t);
  }
  if (urlParams.has('list')) finalParams.set('list', urlParams.get('list'));
  
  // Copy any other params (rel=0, mute=1, etc.)
  for (const [k, v] of urlParams) {
    if (!['t', 'list', 'v'].includes(k)) finalParams.set(k, v);
  }
}

// — Regular youtube.com/watch
else if (cleaned.includes('youtube.com/watch')) {
  const v = urlParams.get('v') || cleaned.split('v=')[1]?.split('&')[0];
  if (v) {
    const ids = v.split(',').filter(Boolean);
    if (ids.length > 1) {
      embedUrl = `https://www.youtube-nocookie.com/embed/?playlist=${ids.join(',')}&${finalParams.toString()}`;
      iframe.src = embedUrl; throw new Error("Done");
    }
    videoId = ids[0];
  }
  if (urlParams.has('list')) finalParams.set('list', urlParams.get('list'));
  if (urlParams.has('t')) {
    const t = parseInt(urlParams.get('t'), 10);
    if (!isNaN(t)) finalParams.set('start', t);
  }
}

// — Shorts
else if (cleaned.includes('youtube.com/shorts/')) {
  videoId = cleaned.split('shorts/')[1].split('?')[0];
}

// — Direct embed path
else if (cleaned.includes('youtube.com/embed/') || cleaned.includes('youtube-nocookie.com/embed/')) {
  const parts = cleaned.split('/embed/');
  if (parts[1]) videoId = parts[1].split('?')[0];
}

// — Playlist-only link
else if (urlParams.has('list') && !videoId) {
  const list = urlParams.get('list');
  if (isPlaylistID(list)) {
    embedUrl = `https://www.youtube-nocookie.com/embed/videoseries?list=${list}&${finalParams.toString()}`;
    iframe.src = embedUrl; throw new Error("Done");
  }
}

// Copy remaining params
for (const [k, v] of urlParams) {
  if (!['v', 't', 'list'].includes(k)) finalParams.set(k, v);
}

// ==================================================================
// Final embed URL construction
if (videoId || urlParams.has('list')) {
  if (!videoId && urlParams.has('list')) {
    // playlist without specific video
    embedUrl = `https://www.youtube-nocookie.com/embed/videoseries?list=${urlParams.get('list')}&${finalParams.toString()}`;
  } else {
    // normal video (with optional playlist context)
    embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}?${finalParams.toString()}`;
  }
} else {
  // Fallback: anything else (user gave direct embed path, twitch, etc.)
  let fallback = 'https://' + cleaned.split('?')[0];
  if (window.location.search) {
    fallback += window.location.search.replace(/^[?]/, '&');
  }
  if (!fallback.includes('autoplay')) {
    fallback += (fallback.includes('?') ? '&' : '?') + 'autoplay=1';
  }
  embedUrl = fallback;
}

iframe.src = embedUrl;
console.log('Final embed URL →', embedUrl);
    </script>
</body>
</html>