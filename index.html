<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Embed Proxy</title>
<style>

body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: black;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}
#container {margin: auto;padding-bottom: 56.25%;}
iframe {position:fixed;top:0;left:0;width: 100%;height: 100%;border: none;}
.error{
  display:none;
  position:absolute;
  inset:0;
  margin:auto;
  width:fit-content;
  max-width:90vw;
  min-width:320px;
  height:fit-content;
  padding:20px;
  background:rgba(0,0,0,0.9);
  border-radius:8px;
  text-align:center;
  box-sizing:border-box;
}
.error input{min-width:50%;padding:10px;margin:10px 0;font-size:16px;background:#222;border:1px solid #555;color:#fff}
.error button{padding:10px 20px;font-size:16px;background:#333;border:none;color:#fff;cursor:pointer}
.error button:hover{background:#555}

</style>
</head>
<body>
<div id="container"><iframe id="embedFrame" allowfullscreen></iframe></div>
<div id="error" class="error">
  No URL provided. Enter a YouTube or other embeddable URL below:<br>
  <input id="urlinput" placeholder="https://youtu.be/..." autofocus><br>
  <button onclick="newEmbedUrl()">Load</button><br><br>
  <a href="https://github.com/Embed-Proxy/embed-proxy.github.io" target="_blank" style="color:#888;font-size:12px;text-decoration:none;">Embed Proxy on GitHub</a>
</div>

<script>
const iframe = document.getElementById('embedFrame');
iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen');

const raw = window.location.pathname.slice(1) + window.location.search;
const inputUrl = document.getElementById('urlinput');
function newEmbedUrl() {const val = inputUrl.value.trim();
  if (val) location.href = '/' + val;}
if (!raw.trim()) {
  document.getElementById('error').style.display = 'block';
  inputUrl.focus();
  inputUrl.addEventListener('keydown', e => { if (e.key === 'Enter') newEmbedUrl(); });
  throw new Error("No input");
}
let embedUrl = '';
const urlParams = new URLSearchParams(window.location.search);
function isPlaylistID(id) {
  const clean = (id || '').split('?')[0];
  return clean.length > 11;
}
// Full YouTube URL parsing
let cleaned = raw
  .replace(/^(https?:\/\/)?(www\.)?/gi, '')
  .replace(/#.*$/, '');
let videoId = null;
let finalParams = new URLSearchParams();
finalParams.set('autoplay', '1');
// — youtu.be links (most common shared form)
if (cleaned.includes('youtu.be/')) {
  videoId = cleaned.split('youtu.be/')[1].split('?')[0].split('&')[0].split('#')[0];
  if (urlParams.has('t')) {
    const t = parseInt(urlParams.get('t'), 10);
    if (!isNaN(t)) finalParams.set('start', t);
  }
  if (urlParams.has('list')) finalParams.set('list', urlParams.get('list'));
  // Copy any other params (rel=0, mute=1, etc.)
  for (const [k, v] of urlParams) {
    if (!['t', 'list', 'v'].includes(k)) finalParams.set(k, v);
  }
}
// — Regular youtube.com/watch
else if (cleaned.includes('youtube.com/watch')) {
  const v = urlParams.get('v') || cleaned.split('v=')[1]?.split('&')[0];
  if (v) {
    const ids = v.split(',').filter(Boolean);
    if (ids.length > 1) {
      embedUrl = `https://www.youtube-nocookie.com/embed/?playlist=${ids.join(',')}&${finalParams.toString()}`;
      iframe.src = embedUrl; throw new Error("Done");
    }
    videoId = ids[0];
  }
  if (urlParams.has('list')) finalParams.set('list', urlParams.get('list'));
  if (urlParams.has('t')) {
    const t = parseInt(urlParams.get('t'), 10);
    if (!isNaN(t)) finalParams.set('start', t);
  }
}
// — Shorts
else if (cleaned.includes('youtube.com/shorts/')) {
  videoId = cleaned.split('shorts/')[1].split('?')[0];
}
// — Direct embed path
else if (cleaned.includes('youtube.com/embed/') || cleaned.includes('youtube-nocookie.com/embed/')) {
  const parts = cleaned.split('/embed/');
  if (parts[1]) videoId = parts[1].split('?')[0];
}
// — Playlist-only link
else if (urlParams.has('list') && !videoId) {
  const list = urlParams.get('list');
  if (isPlaylistID(list)) {
    embedUrl = `https://www.youtube-nocookie.com/embed/videoseries?list=${list}&${finalParams.toString()}`;
    iframe.src = embedUrl; throw new Error("Done");
  }
}
// Copy remaining params
for (const [k, v] of urlParams) {
  if (!['v', 't', 'list'].includes(k)) finalParams.set(k, v);
}
// Final embed URL construction
if (videoId || urlParams.has('list')) {
  if (!videoId && urlParams.has('list')) {
    // playlist without specific video
    embedUrl = `https://www.youtube-nocookie.com/embed/videoseries?list=${urlParams.get('list')}&${finalParams.toString()}`;
  } else {
    // normal video (with optional playlist context)
    embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}?${finalParams.toString()}`;
  }
} else {
  // Fallback: anything else (user gave direct embed path, twitch, etc.)
  let fallback = 'https://' + cleaned.split('?')[0];
  if (window.location.search) {
    fallback += window.location.search.replace(/^[?]/, '&');
  }
  if (!fallback.includes('autoplay')) {
    fallback += (fallback.includes('?') ? '&' : '?') + 'autoplay=1';
  }
  embedUrl = fallback;
}
iframe.src = embedUrl;
console.log('Final embed URL →', embedUrl);

</script>
</body>
</html>